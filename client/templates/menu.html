<template name="menu">
	<div class="sidebar-menu">
		{{!-- favourite --}}
		{{#if currentUser}}
		{{#if $gt favouriteCount 0}}
		<div class="sidebar-menu-header">FAVOURITE</div>
		<div class="ui inverted middle aligned list">
		{{#each channels}}
		{{#if favourite}}
			{{> menu_channel_item}}
		{{/if}}
		{{/each}}
		{{#each directChats}}
		{{#if favourite}}
			{{> menu_direct_item}}
		{{/if}}
		{{/each}}
		</div>
		<div class="ui inverted divider" style="margin-top: 0.5em"></div>
		{{/if}}
		{{/if}}
		{{!-- channel messages --}}
		<div class="sidebar-menu-header">CHANNELS</div>
		<div class="ui inverted middle aligned list">
			{{#each channels}}
			{{#unless favourite}}
				{{> menu_channel_item}}
			{{/unless}}
			{{/each}}

			{{#if currentUser}}
			{{#if $.Session.get '__M_S_isAddingNewChannel'}}
			{{> menu_addNewChannelItem}}
			{{else}}
			{{> menu_createNewChannelItem}}
			{{/if}}
			{{/if}}
		</div>

		{{#if currentUser}}
		<div class="ui inverted divider" style="margin-top: 0.5em"></div>
		{{!-- direct messages --}}
		<div class="sidebar-menu-header">DIRECT MESSAGES</div>
		<div class="ui inverted middle aligned list">
			{{#each directChats}}
			{{#unless favourite}}
				{{> menu_direct_item}}
			{{/unless}}
			{{/each}}
		</div>

		{{#if $.Session.get '__M_S_isAddingNewDirectChat'}}
		{{> menu_addNewDirectChatItem}}
		{{else}}
		{{> menu_createNewDirectChatItem}}
		{{/if}}
		{{/if}}
	</div>
</template>

<!-- ####################################################################### -->
<template name="menu_channel_item">
	<a href="/channel/{{name}}"
		class="item sidebar-menu-item hoverable {{__M_S.isActive 'channel' name}}">
		<span>#</span>{{name}}
		{{#if currentUser}}
		{{#unless __M_S.isActive 'channel' name}}
		{{#if $gt unread 0}}
		<div class="pink right floated ui label unread-label">{{unread}}</div>
		{{/if}}
		{{/unless}}
		{{/if}}
	</a>
</template>
<!-- ####################################################################### -->
<template name="menu_direct_item">
	<a href="/direct/{{name}}"
		class="item sidebar-menu-item hoverable {{__M_S.isActive 'direct' name}}">
		<span>@</span>{{name}}
		{{#unless __M_S.isActive 'direct' name}}
		{{#if $gt unread 0}}
		<div class="pink right floated ui label unread-label">{{unread}}</div>
		{{/if}}
		{{/unless}}
	</a>
</template>
<!-- ####################################################################### -->
<template name="menu_createNewChannelItem">
	<a class="item sidebar-menu-item hoverable">
		<em>Create new channel...</em>
	</a>
</template>
<!-- ####################################################################### -->
<template name="menu_addNewChannelItem">
	<div class="item sidebar-menu-item">
		<form class="ui form">
			<div class="ui transparent inverted icon input">
				<span class="flex-center-align">#</span>
				<input type="text" placeholder="New channel...">
				<i class="checkmark link icon" style="margin-right: 1.2em; display: none"></i>
				<i class="cancel link icon"></i>
			</div>
			<small style="opacity: 0.8">* duplicate channel name is not allowed</small>
		</form>
	</div>
</template>

<!-- ####################################################################### -->
<template name="menu_createNewDirectChatItem">
	<div class="ui inverted middle aligned list">
		<a class="item sidebar-menu-item hoverable">
			<em>Create new chat...</em>
		</a>
	</div>
</template>
<!-- ####################################################################### -->
<template name="menu_addNewDirectChatItem">
	<div class="ui inverted middle aligned list">
		<div class="item sidebar-menu-item">
			<form class="ui form">
				<div class="ui transparent inverted icon input">
					<span>@</span>
					{{> esInput index="users" placeholder="Choose a buddy..."}}
					<i class="cancel link icon"></i>
				</div>
			</form>
		</div>
	</div>
	<div class="ui tiny inverted middle aligned divided list user-list"
		style="background-color: rgba(255, 255, 255, 0.2)">
		{{!-- show all users when search input is empty --}}
		{{#ifEsInputIsEmpty index="users"}}
		{{#each users}}
		{{> menu_addNewDirectChatItem_userItem}}
		{{/each}}
		{{/ifEsInputIsEmpty}}
		{{!-- render search results --}}
		{{#esEach index="users"}}
		{{> menu_addNewDirectChatItem_userItem}}
		{{/esEach}}
		{{#ifEsHasNoResults index="users"}}
		<div class="item sidebar-menu-item" style="padding-left: 2rem">No results found!</div>
		{{/ifEsHasNoResults}}
	</div>
</template>
<!-- ####################################################################### -->
<template name="menu_addNewDirectChatItem_userItem">
	<a href="/direct/{{username}}" class="item sidebar-menu-item hoverable"
		style="margin: 0; border-radius: 0">
		<div class="right floated ui {{#if status.online}}green{{else}}grey{{/if}} empty circular label"
			style="margin: 0.5em 1em"></div>
		<div class="ui avatar image" style="padding-right: 0">
			<img src="{{__M_S.SMALL_AVATAR_DIR}}/{{profile.avatar}}">
		</div>
		<div class="content" style="padding-left: 1em">
			<div class="header">{{username}}</div>
		</div>
	</a>
</template>
<!-- ####################################################################### -->
<template name="menu_modal">
	<div class="ui small basic modal menu-modal">
		{{!-- header --}}
		<div class="ui icon header">
			<i class="external share icon"></i>
			Are you sure?
		</div>
		{{!-- content --}}
		<div class="content">
			<p>Once created, you will not be able to edit the channel name or delete the channel.</p>
		</div>
		{{!-- actions --}}
		<div class="actions">
			<div class="ui red basic cancel inverted button">
				<i class="remove icon"></i>
				Cancel
			</div>
			<div class="ui green ok inverted button">
				<i class="checkmark icon"></i>
				Yes
			</div>
		</div>
	</div>
</template>
